# Устаревшее ключевое слово "var"

`let` и `const` ведут себя одинаково по отношению к лексическому окружению, области видимости.

Но `var` – это совершенно другой зверь, берущий своё начало с давних времён. Обычно `var` не используется в современных скриптах, но всё ещё может скрываться в старых.

# Для «var» не существует блочной области видимости

Область видимости переменных var ограничивается либо функцией, либо, если переменная глобальная, то скриптом. Такие переменные доступны за пределами блока.

```JavaScript
if (true) {
  var test = true; // используем var вместо let
}

alert(test); // true, переменная существует вне блока if
```

Так как var игнорирует блоки, мы получили глобальную переменную test.

А если бы мы использовали `let test` вместо `var test`, тогда переменная была бы видна только внутри `if`:

```JavaScript
if (true) {
  let test = true; // используем let
}

alert(test); // Error: test is not defined
```

Аналогично для циклов: var не может быть блочной или локальной внутри цикла:

```JavaScript
for (var i = 0; i < 10; i++) {
  // ...
}

alert(i); // 10, переменная i доступна вне цикла, т.к. является глобальной переменной
```

Если блок кода находится внутри функции, то var становится локальной переменной в этой функции:

```JavaScript
function sayHi() {
  if (true) {
    var phrase = "Привет";
  }

  alert(phrase); // срабатывает и выводит "Привет"
}

sayHi();
alert(phrase); // Ошибка: phrase не определена (видна в консоли разработчика)
```

# «var» допускает повторное объявление

Используя `var`, можно переобъявлять переменную сколько угодно раз. Повторные `var` игнорируются:

```JavaScript
var user = "Пётр";

var user; // ничего не делает, переменная объявлена раньше
// ...нет ошибки

alert(user); // Пётр
```

Если дополнительно присвоить значение, то переменная примет новое значение:

```JavaScript
var user = "Пётр";

var user = "Иван";

alert(user); // Иван
```

# «var» обрабатываются в начале запуска функции

Объявления переменных var обрабатываются в начале выполнения функции (или запуска скрипта, если переменная является глобальной).

Другими словами, переменные var считаются объявленными с самого начала исполнения функции вне зависимости от того, в каком месте функции реально находятся их объявления (при условии, что они не находятся во вложенной функции).

Т.е. этот код:

```JavaScript
function sayHi() {
  phrase = "Привет";

  alert(phrase);

  var phrase;
}
sayHi();
```

…Технически полностью эквивалентен следующему (объявление переменной var phrase перемещено в начало функции):

```JavaScript
function sayHi() {
  var phrase;

  phrase = "Привет";

  alert(phrase);
}
sayHi();
```

…И даже коду ниже (как вы помните, блочная область видимости игнорируется):

```JavaScript
function sayHi() {
  phrase = "Привет"; // (*)

  if (false) {
    var phrase;
  }

  alert(phrase);
}
sayHi();
```

Это поведение называется `«hoisting»` (всплытие, поднятие), потому что все объявления переменных `var` «всплывают» в самый верх функции.

`Объявления переменных «всплывают», но присваивания значений – нет.`

```JavaScript
function sayHi() {
  alert(phrase);

  var phrase = "Привет";
}

sayHi(); // undefined
```

Строка `var phrase = "Привет"` состоит из двух действий:

- Объявление переменной `var`

- Присвоение значения в переменную `=`.

```JavaScript
function sayHi() {
  var phrase; // объявление переменной срабатывает вначале...

  alert(phrase); // undefined

  phrase = "Привет"; // ...присвоение - в момент, когда исполнится данная строка кода.
}

sayHi();
```

# IIFE

«Immediately-invoked function expressions» (сокращенно IIFE).

IIFE выглядит следующим образом:


```JavaScript
(function() {

  var message = "Привет";

  alert(message); // Привет

})();
```
Здесь создаётся и немедленно вызывается Function Expression. Так что код выполняется сразу же и у него есть свои локальные переменные.

Так что скобки вокруг функции – это трюк, который позволяет объяснить JavaScript, что функция была создана в контексте другого выражения, а значит, что это Function Expression: ей не нужно имя и её можно вызвать немедленно.


Помимо круглых скобок существуют и другие способы сообщить JavaScript, что мы имеем в виду Function Expression:

```JavaScript
// Способы создания IIFE

(function() {
  alert("Круглые скобки вокруг функции");
})();

(function() {
  alert("Круглые скобки вокруг всего выражения");
}());

!function() {
  alert("Выражение начинается с логического оператора НЕ");
}();

+function() {
  alert("Выражение начинается с унарного плюса");
}();
```

# Итого
Существует 2 основных отличия var от let/const:

- Переменные var не имеют блочной области видимости, они ограничены, как минимум, телом функции.

- Объявления (инициализация) переменных var производится в начале исполнения функции (или скрипта для глобальных переменных).


